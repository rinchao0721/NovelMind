# NovelMind 使用文档

## 目录

1. [安装与配置](#安装与配置)
2. [导入小说](#导入小说)
3. [AI 分析](#ai-分析)
4. [查看结果](#查看结果)
5. [数据导出](#数据导出)
6. [常见问题](#常见问题)
7. [最佳实践](#最佳实践)

---

## 安装与配置

### 1. 安装应用

#### 开发版（从源码运行）

```bash
# 克隆项目
git clone https://github.com/your-username/novelmind.git
cd novelmind

# 安装依赖
npm run setup

# 启动应用
npm run dev
```

#### 发布版（安装包）

从 [Releases 页面](https://github.com/your-username/novelmind/releases) 下载对应平台的安装包：

- **Windows**: `NovelMind-Setup.exe` (安装版) 或 `NovelMind-Portable.exe` (便携版)
- **macOS**: `NovelMind.dmg`
- **Linux**: `NovelMind.AppImage` 或 `novelmind.deb`

### 2. 配置 LLM API 密钥

首次运行需要配置至少一个 LLM 提供商的 API 密钥。

#### 进入设置页面

1. 启动 NovelMind
2. 点击左侧导航栏的"⚙️ 设置"
3. 选择"LLM API"标签页

#### 选择提供商

根据您的需求选择一个或多个提供商：

| 提供商 | 推荐模型 | 获取密钥链接 | 特点 |
|--------|---------|-------------|------|
| **OpenAI** | GPT-4o | [platform.openai.com](https://platform.openai.com/api-keys) | 最强大，价格较高 |
| **Anthropic Claude** | Claude 3.5 Sonnet | [console.anthropic.com](https://console.anthropic.com/) | 理解能力强，上下文长 |
| **Google Gemini** | Gemini 1.5 Flash | [makersuite.google.com](https://makersuite.google.com/app/apikey) | 免费额度大 |
| **DeepSeek** | DeepSeek Chat | [platform.deepseek.com](https://platform.deepseek.com/) | 性价比高 |
| **阿里百炼** | Qwen-Plus | [dashscope.aliyun.com](https://dashscope.aliyun.com/) | 中文理解好 |
| **智谱 AI** | GLM-4 | [open.bigmodel.cn](https://open.bigmodel.cn/) | 中文专业 |
| **百度文心** | ERNIE 4.0 | [console.bce.baidu.com](https://console.bce.baidu.com/qianfan/) | 稳定可靠 |

#### 配置步骤

1. 展开对应提供商的折叠面板
2. 填入 API Key
3. 选择模型（可选，使用默认即可）
4. 点击"测试连接"验证配置
5. 看到"✅ 连接成功"后，点击底部"保存设置"按钮

#### API 密钥安全

- 密钥使用 AES-256 加密存储在本地
- 不会上传到任何服务器
- 仅在调用 LLM API 时使用

### 3. 设置默认提供商

在"选择默认 LLM 提供商"区域选择您最常用的提供商。这将用于所有分析任务，除非手动切换。

---

## 导入小说

### 支持的文件格式

- **TXT** - 纯文本文件（推荐 UTF-8 编码）
- **DOCX** - Microsoft Word 文档
- **EPUB** - 电子书格式
- **MOBI** - Kindle 格式（实验性支持）

### 导入步骤

#### 方法一：首页导入

1. 在首页点击"📤 导入小说"卡片
2. 或点击右上角"+ 导入新小说"按钮
3. 在弹出的对话框中：
   - 拖拽文件到虚线框
   - 或点击虚线框选择文件
4. 点击"开始导入"

#### 方法二：从菜单导入

1. 点击顶部菜单栏"文件" → "导入小说"
2. 选择文件
3. 确认导入

### 导入注意事项

- **文件大小**: 建议不超过 50MB
- **文本编码**: TXT 文件请使用 UTF-8 编码，避免乱码
- **文件完整性**: 确保文件完整，章节结构清晰
- **格式规范**: 
  - 章节标题建议包含"第X章"、"Chapter X"等关键词
  - 段落之间有明确换行

### 导入后

导入成功后，小说会出现在首页的"最近项目"列表中，状态显示为"⚪ 待分析"。

---

## AI 分析

### 进入分析页面

1. 点击左侧导航栏"📊 剧情分析"
2. 或在首页点击小说卡片

### 分析配置

#### 1. 选择小说

在顶部下拉框选择要分析的小说。选择后会显示小说的基本信息：

- 书名
- 作者
- 章节数
- 总字数
- 当前分析状态

#### 2. 配置分析选项

**分析范围**

- **全书分析** (推荐) - 分析整本小说
- **部分章节** - 仅分析指定章节范围（用于测试或长篇小说）

**分析深度**

- **快速分析** - 更少 API 调用，速度快，精度略低
- **标准分析** (推荐) - 平衡速度与精度
- **深度分析** - 更多 API 调用，精度高，耗时长

**分析项目**（可多选）

- ✅ **人物识别** - 提取所有角色及其属性
- ✅ **关系分析** - 分析人物之间的关系
- ✅ **情节追踪** - 提取关键剧情事件
- ✅ **章节摘要** - 生成每章摘要

#### 3. 开始分析

点击"🎬 开始分析"按钮。分析时间取决于：

- 小说长度（章节数 × 每章字数）
- 选择的分析深度
- LLM API 响应速度

**预估时间**：

| 小说长度 | 快速分析 | 标准分析 | 深度分析 |
|---------|---------|---------|---------|
| 短篇 (< 10万字) | 1-2 分钟 | 3-5 分钟 | 5-10 分钟 |
| 中篇 (10-50万字) | 3-5 分钟 | 8-15 分钟 | 15-30 分钟 |
| 长篇 (> 50万字) | 5-10 分钟 | 20-40 分钟 | 40-90 分钟 |

### 分析进度

分析过程中会实时显示：

- **进度条** - 整体完成百分比
- **当前步骤** - 正在进行的任务
- **日志记录** - 详细的操作日志和时间戳

可随时点击"取消分析"停止任务。

### 分析完成

完成后会显示统计信息：

- 📊 识别人物数量
- 🔗 人物关系数量
- 📖 主要情节数量
- 📄 分析章节数量

点击对应按钮可快速跳转到查看页面。

---

## 查看结果

### 关系图谱

#### 功能介绍

关系图谱使用力导向算法展示人物关系网络：

- **节点大小** - 代表人物重要性
- **连线粗细** - 代表关系强度
- **连线颜色** - 代表关系类型

#### 操作指南

**基本操作**

- **拖拽节点** - 鼠标左键拖动节点位置
- **缩放画布** - 鼠标滚轮放大缩小
- **平移画布** - 鼠标右键拖动或按住 Ctrl + 鼠标左键拖动
- **查看详情** - 点击节点弹出人物详情面板

**工具栏功能**

- 🔍 **放大** - 放大图谱
- 🔍 **缩小** - 缩小图谱
- 📐 **重置** - 恢复默认视图
- 📥 **导出图片** - 保存为高清 PNG

**布局方式**

- **力导向布局** (推荐) - 自动调整节点位置，关系清晰
- **环形布局** - 节点排列成圆形

#### 筛选功能

使用右侧筛选面板：

**关系类型筛选**

勾选要显示的关系类型：

- 🔴 亲属关系
- 🟢 朋友关系
- ⚫ 敌对关系
- 🟠 恋人关系
- 🔵 同事关系
- ⚪ 其他关系

**重要性筛选**

拖动滑块设置最低重要性阈值，隐藏次要人物。

### 人物列表

查看所有角色的详细信息卡片：

- 人物姓名和别名
- 首次出场章节
- 重要性评分
- 人物描述
- 性格特点
- 相关人物

支持按重要性、首次出场排序。

### 时间线

按时间顺序查看关键剧情事件：

- 事件标题
- 事件描述
- 涉及人物
- 事件类型（冲突、揭示、转折、高潮、解决）
- 重要性评分

### 章节摘要

查看每章的 AI 生成摘要，快速回顾剧情。

---

## 数据导出

### 导出格式

#### JSON 格式

**特点**：

- 包含完整数据结构
- 便于程序读取和二次开发
- 可导入其他工具

**内容**：

```json
{
  "novel": {
    "title": "红楼梦",
    "author": "曹雪芹",
    "chapters": 120
  },
  "characters": [
    {
      "name": "贾宝玉",
      "aliases": ["宝二爷", "怡红公子"],
      "importance": 1.0,
      "description": "..."
    }
  ],
  "relationships": [
    {
      "source": "贾宝玉",
      "target": "林黛玉",
      "type": "lover",
      "strength": 1.0
    }
  ],
  "events": [...]
}
```

#### Markdown 格式

**特点**：

- 人类可读的文档格式
- 便于分享和查看
- 支持 GitHub、Notion 等平台

**内容**：

- 小说基本信息
- 人物列表（按重要性排序）
- 人物关系（按类型分组）
- 关键事件时间线

### 导出步骤

1. 在分析结果页面点击"📥 导出结果"按钮
2. 在弹出的对话框中选择格式：
   - 🗂️ **JSON** - 适合开发者
   - 📝 **Markdown** - 适合阅读分享
3. 点击"导出"按钮
4. 选择保存位置和文件名
5. 导出完成后会显示成功提示

### 图片导出

在关系图谱页面：

1. 调整图谱到满意的视图
2. 点击工具栏"📥 导出图片"
3. 图片会自动保存到下载目录
4. 分辨率：2x 高清（适合打印）

---

## 常见问题

### 安装问题

**Q: Windows 提示"无法验证发布者"怎么办？**

A: 这是正常的，因为应用没有数字签名。点击"更多信息" → "仍要运行"即可。

**Q: macOS 提示"无法打开应用"怎么办？**

A: 右键点击应用 → 选择"打开" → 点击"打开"确认。或在系统设置中允许该应用。

**Q: Python 依赖安装失败？**

A: 确保安装了 Python 3.11 或 3.12，并安装了 uv：

```bash
pip install uv
cd backend
uv sync
```

### 使用问题

**Q: 导入小说后显示乱码？**

A: TXT 文件请使用 UTF-8 编码保存。可使用记事本打开后"另存为"选择 UTF-8 编码。

**Q: 分析一直卡在某个进度？**

A: 可能原因：
1. LLM API 响应慢，请耐心等待
2. API 额度不足，检查账户余额
3. 网络问题，检查网络连接

**Q: 分析结果不准确？**

A: 尝试以下方法：
1. 使用"深度分析"模式
2. 切换更强大的模型（如 GPT-4o, Claude 3.5 Sonnet）
3. 检查小说文本格式是否规范

**Q: 如何更换 LLM 提供商？**

A: 进入设置页面，配置新的提供商，并设为默认提供商即可。

### 技术问题

**Q: 后端服务启动失败？**

A: 检查端口 5001 是否被占用：

```bash
# Windows
netstat -ano | findstr :5001

# macOS/Linux
lsof -i :5001
```

**Q: 如何查看详细日志？**

A: 
- 前端日志：按 F12 打开开发者工具 → Console
- 后端日志：查看终端输出

**Q: 数据存储在哪里？**

A:
- Windows: `%APPDATA%\NovelMind\`
- macOS: `~/Library/Application Support/NovelMind/`
- Linux: `~/.config/NovelMind/`

---

## 最佳实践

### 提升分析质量

1. **选择合适的模型**
   - 中文小说：推荐 Qwen、GLM-4、ERNIE
   - 英文小说：推荐 GPT-4o、Claude 3.5
   - 复杂小说：使用深度分析模式

2. **优化文本格式**
   - 章节标题清晰明确
   - 段落换行规范
   - 去除多余的空格和特殊字符

3. **分步分析**
   - 长篇小说可先分析前几章测试效果
   - 确认结果满意后再分析全书

### 节省 API 成本

1. **合理选择深度**
   - 测试时使用快速分析
   - 重要作品使用标准或深度分析

2. **使用免费额度**
   - Gemini 有较大的免费额度
   - 多个账号轮换使用

3. **本地缓存**
   - 分析结果会自动缓存
   - 重复查看不会再次调用 API

### 数据管理

1. **定期导出**
   - 重要分析结果及时导出备份
   - 使用 JSON 格式便于迁移

2. **清理数据**
   - 定期删除不需要的小说和分析结果
   - 在设置中使用"清除所有数据"

3. **版本管理**
   - 导出的 JSON 文件可用 Git 管理
   - 便于追踪分析结果的变化

---

## 进阶技巧

### 自定义 API 配置

如果您有自己部署的兼容 OpenAI 格式的 API（如 Ollama、vLLM），可以使用"自定义 API"：

1. 选择"自定义 OpenAI 兼容 API"
2. 填入您的 API 地址（如 `http://localhost:11434/v1`）
3. 填入 API Key（如不需要可随意填写）
4. 填入模型名称（如 `llama3`）
5. 测试连接

### Neo4j 图数据库

如需使用 Neo4j 存储关系数据：

1. 安装 Neo4j Desktop 或使用 Neo4j Aura
2. 在设置中启用 Neo4j
3. 填入连接信息（URI、用户名、密码）
4. 测试连接

优势：
- 更强大的图查询能力
- 可视化效果更好
- 支持复杂关系分析

### API 集成

NovelMind 提供 REST API，可供其他应用调用：

```bash
# API 文档地址
http://localhost:5001/docs

# 示例：获取小说列表
curl http://localhost:5001/api/novels

# 示例：开始分析
curl -X POST http://localhost:5001/api/analysis/start \
  -H "Content-Type: application/json" \
  -d '{"novel_id": "1", "depth": "standard"}'
```

---

## 获取帮助

- 📖 [完整文档](https://github.com/your-username/novelmind/wiki)
- 💬 [GitHub Discussions](https://github.com/your-username/novelmind/discussions)
- 🐛 [报告问题](https://github.com/your-username/novelmind/issues)

---

<div align="center">

**祝您使用愉快！**

如有任何问题或建议，欢迎在 GitHub 上与我们交流。

</div>
