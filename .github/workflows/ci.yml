name: CI 检查

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # 前端代码检查
  frontend-check:
    name: 前端代码检查
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 设置 Node.js 20.x
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
      
      - name: 安装前端依赖
        run: npm ci
      
      - name: TypeScript 类型检查
        run: npm run typecheck
      
      - name: 前端构建测试
        run: npm run build

  # 后端代码检查
  backend-check:
    name: 后端代码检查
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 安装 uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
      
      - name: 设置 Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: 安装后端依赖
        run: |
          cd backend
          uv sync
      
      - name: Ruff 代码检查
        run: |
          cd backend
          uv run ruff check .
      
      - name: Ruff 格式检查
        run: |
          cd backend
          uv run ruff format --check .
